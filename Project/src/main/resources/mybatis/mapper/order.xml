<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="order">
  <select id="new_order_list" parameterType="String" resultType="comm.vo.OrderVO">
    SELECT o.*, p.name as prod_name, c.cus_id,i.option_name,i.count as option_count
    FROM `order` as o
    LEFT JOIN product as p ON o.prod_no = p.id
    LEFT JOIN customer as c ON c.id = o.cus_no
    LEFT JOIN inventory as i ON o.inventory_no = i.id
    WHERE p.seller_no = #{seller_no}

  </select>
  <select id="get_order_one" parameterType="String" resultType="comm.vo.OrderVO">
    SELECT o.*,p.name as prod_name,d.*,i.option_name,i.count as option_count,c.cus_id,c.name as cus_name
    FROM `order` as o
    LEFT JOIN product as p ON o.prod_no = p.id
    LEFT JOIN customer as c ON c.id = o.cus_no
    LEFT JOIN inventory as i ON o.inventory_no = i.id
    LEFT JOIN delivery as d ON o.deli_no = d.id
    WHERE o.id = #{order_no};
  </select>
  <update id="change_status" parameterType="String">
    UPDATE `order`
    SET
    status = #{status},
    refund_completed_date = CASE
    WHEN #{status} = '11' THEN NOW()
    ELSE refund_completed_date
    END
    WHERE tid = #{tid}
  </update>
  <select id="count" parameterType="String" resultType="java.util.Map">
    SELECT status,COUNT(*) as count
    FROM `order` as o
    JOIN product as p on p.id = o.prod_no
    WHERE p.seller_no = #{seller_no}
    group by status;
  </select>
  <update id="cancel_order" parameterType="Map" >
    UPDATE `order`
    SET
    reason_seller=#{reason_seller},
    status=#{status}
    WHERE id = #{order_no}
  </update>
</mapper>
