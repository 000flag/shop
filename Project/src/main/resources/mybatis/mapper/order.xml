<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="order">

    <!-- 전체 주문내역 조회 -->
    <select id="select_all" resultType="user.vo.OrderVO" parameterType="String">
        SELECT DISTINCT s.name AS brand, p.prod_code AS prod_code, p.name AS prod_name, p.price AS prod_price, p.sale AS prod_sale, p.prod_image AS prod_image,
        p.saled_price AS prod_saled_price, i.option_name AS option_name, o.* FROM `order` o
        INNER JOIN product p ON o.prod_no = p.id
        INNER JOIN seller s ON p.seller_no = s.id
        INNER JOIN inventory i ON i.prod_no = p.id
        WHERE o.cus_no = ${cus_no} AND o.order_date IS NOT NULL
        ORDER BY o.order_date DESC
    </select>

    <!-- 날짜 별 주문내역 조회 -->
    <select id="select_date" resultType="user.vo.OrderVO" parameterType="map">
        SELECT DISTINCT s.name AS brand, p.prod_code AS prod_code, p.name AS prod_name, p.price AS prod_price, p.sale AS prod_sale, p.prod_image AS prod_image,
        p.saled_price AS prod_saled_price, i.option_name AS option_name, o.* FROM `order` o
        INNER JOIN product p ON o.prod_no = p.id
        INNER JOIN seller s ON p.seller_no = s.id
        INNER JOIN inventory i ON i.prod_no = p.id
        WHERE cus_no = #{cus_no}
        <if test="startDate != null and startDate != '' and endDate != null and endDate != ''">
            AND o.order_date BETWEEN #{startDate} AND #{endDate}
        </if>
        ORDER BY o.order_date DESC
    </select>
</mapper>